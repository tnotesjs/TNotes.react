# [0060. react v19](https://github.com/tnotesjs/TNotes.react/tree/main/notes/0060.%20react%20v19)

<!-- region:toc -->

- [1. ğŸ¯ æœ¬èŠ‚å†…å®¹](#1--æœ¬èŠ‚å†…å®¹)
- [2. ğŸ«§ è¯„ä»·](#2--è¯„ä»·)
- [3. ğŸ¤– react v19 éƒ½æœ‰å“ªäº›é‡å¤§æ›´æ–°ï¼Ÿï¼ˆå¾…æ•´ç†ï¼‰](#3--react-v19-éƒ½æœ‰å“ªäº›é‡å¤§æ›´æ–°å¾…æ•´ç†)
  - [3.1. æ ¸å¿ƒä¸»é¢˜ â€” Actionsï¼ˆæ‰©å±•çš„ Transitionï¼‰ä¸æ›´æ·±çš„è¡¨å•/æœåŠ¡å™¨é›†æˆ](#31-æ ¸å¿ƒä¸»é¢˜--actionsæ‰©å±•çš„-transitionä¸æ›´æ·±çš„è¡¨å•æœåŠ¡å™¨é›†æˆ)
  - [3.2. æ–°çš„ Hook / API](#32-æ–°çš„-hook--api)
  - [3.3. React DOM å®¢æˆ·ç«¯ï¼ˆè¡¨å•/èµ„æº/è„šæœ¬/æ ·å¼ç›¸å…³çš„æ”¹è¿›ï¼‰](#33-react-dom-å®¢æˆ·ç«¯è¡¨å•èµ„æºè„šæœ¬æ ·å¼ç›¸å…³çš„æ”¹è¿›)
  - [3.4. æœåŠ¡ç«¯æ¸²æŸ“ / Server Components / é™æ€ç”Ÿæˆ](#34-æœåŠ¡ç«¯æ¸²æŸ“--server-components--é™æ€ç”Ÿæˆ)
  - [3.5. é‡è¦è¡Œä¸ºå˜åŒ– / Strict Mode & è¿è¡Œæ—¶æ³¨æ„äº‹é¡¹](#35-é‡è¦è¡Œä¸ºå˜åŒ–--strict-mode--è¿è¡Œæ—¶æ³¨æ„äº‹é¡¹)
  - [3.6. è¢«ç§»é™¤ / å¼ƒç”¨ï¼ˆBreaking changes & Removals â€” è¦è®¤çœŸå¯¹å¾…ï¼‰](#36-è¢«ç§»é™¤--å¼ƒç”¨breaking-changes--removals--è¦è®¤çœŸå¯¹å¾…)
  - [3.7. TypeScript æ”¹åŠ¨ä¸ Codemodï¼ˆå®æ“å»ºè®®ï¼‰](#37-typescript-æ”¹åŠ¨ä¸-codemodå®æ“å»ºè®®)
  - [3.8. å‡çº§å»ºè®®ï¼ˆå®è·µæ­¥éª¤ï¼‰](#38-å‡çº§å»ºè®®å®è·µæ­¥éª¤)
  - [3.9. å¸¸è§è¿ç§»ç‰‡æ®µï¼ˆç¤ºä¾‹ï¼‰](#39-å¸¸è§è¿ç§»ç‰‡æ®µç¤ºä¾‹)
  - [3.10. æ€»ç»“](#310-æ€»ç»“)
- [4. ğŸ”— å¼•ç”¨ï¼ˆå®˜æ–¹åŸæ–‡ï¼‰](#4--å¼•ç”¨å®˜æ–¹åŸæ–‡)

<!-- endregion:toc -->

## 1. ğŸ¯ æœ¬èŠ‚å†…å®¹

- react v19 çš„é‡å¤§æ›´æ–°

## 2. ğŸ«§ è¯„ä»·

- å¿«é€Ÿäº†è§£ react v19 çš„ä¸€äº›é‡å¤§å˜æ›´

## 3. ğŸ¤– react v19 éƒ½æœ‰å“ªäº›é‡å¤§æ›´æ–°ï¼Ÿï¼ˆå¾…æ•´ç†ï¼‰

- ä»¥ä¸‹å†…å®¹åŸºäº React v19 å®˜æ–¹ Release Notes + React å›¢é˜Ÿçš„åšå®¢/å‡çº§æŒ‡å— çš„æ¢³ç†ä¸è§£è¯»

### 3.1. æ ¸å¿ƒä¸»é¢˜ â€” Actionsï¼ˆæ‰©å±•çš„ Transitionï¼‰ä¸æ›´æ·±çš„è¡¨å•/æœåŠ¡å™¨é›†æˆ

- React 19 çš„ä¸­å¿ƒæ€æƒ³ä¹‹ä¸€æ˜¯æŠŠâ€œå¼‚æ­¥åŠ¨ä½œï¼ˆActionsï¼‰â€ä½œä¸ºæ¸²æŸ“ä¸æ•°æ®äº¤äº’çš„ç¬¬ä¸€ç±»å…¬æ°‘ï¼š`startTransition` ç°åœ¨å¯ä»¥æ¥å— async å‡½æ•°ï¼ˆActionï¼‰ï¼ŒAction å¯åœ¨åå°æ‰§è¡Œå‰¯ä½œç”¨ï¼ˆä¾‹å¦‚ `fetch()`ï¼‰ã€æ”¯æŒé”™è¯¯å¤„ç†ã€æ”¯æŒä¹è§‚æ›´æ–°ï¼Œå¹¶ç”± React ç®¡ç† pending çŠ¶æ€ä¸æœ€ç»ˆ commitã€‚è¿™ä¸ªè®¾è®¡æŠŠå¸¸è§çš„ã€Œæäº¤ â†’ è¯·æ±‚ â†’ æ›´æ–° UIï¼ˆå« pending / error / optimisticï¼‰ã€æµç¨‹çº³å…¥æ¸²æŸ“æ¨¡å‹ï¼Œä»è€Œç®€åŒ–äº†è®¸å¤šå¸¸è§æ¨¡å¼ï¼ˆå°¤å…¶æ˜¯è¡¨å•ã€CRUD åœºæ™¯ï¼‰ã€‚
- ç®€çŸ­ç¤ºä¾‹ï¼š

```js
import { useTransition } from 'react'

function onSubmit(data) {
  startTransition(async () => {
    // è¿™æ˜¯ä¸€ä¸ª Actionï¼šå¯ä»¥ await è¯·æ±‚ã€æŠ›é”™ã€åšä¹è§‚æ›´æ–°ç­‰
    await api.update(data)
  })
}
```

### 3.2. æ–°çš„ Hook / API

- `startTransition` å¯ä»¥æ¥å— async å‡½æ•°ï¼ˆActionï¼‰ï¼ŒTransition å¯ä»¥åŒ…å«å¤šä¸ª Actionsã€‚
- `useActionState`ï¼šæŠŠ Action å°è£…æˆå¯å¤ç”¨çš„æäº¤å‡½æ•°ï¼Œè¿”å› [data/error, actionFn, pending]ï¼Œéå¸¸é€‚åˆè¡¨å•åœºæ™¯ã€‚
- `useOptimistic`ï¼šç”¨äºä¹è§‚æ›´æ–° â€”â€” åœ¨ Transition è¿›è¡Œæ—¶ç«‹å³æ¸²æŸ“é¢„æœŸå€¼ï¼ŒTransition å®Œæˆæˆ–å›æ»šæ—¶è‡ªåŠ¨æ¢å¤/æœ€ç»ˆåŒæ­¥ã€‚
- `use`ï¼šå¯ä»¥åœ¨ render ä¸­è¯»å– promise æˆ– Contextï¼›ä¼ å…¥ promise ä¼šå¯¼è‡´ç»„ä»¶ suspendï¼ŒReact ä¼šç­‰å¾…è¯¥ promise resolveã€‚æ³¨æ„ï¼šä¸èƒ½ä¼ å…¥åœ¨ render ä¸­æ–°åˆ›å»ºçš„ promiseï¼ˆå¿…é¡»ç”± Suspense å…¼å®¹çš„åº“/æ¡†æ¶ç¼“å­˜æä¾›ï¼‰ã€‚
- `ref` ç°åœ¨å¯ä»¥ä½œä¸ºæ™®é€š prop ä¼ é€’ï¼ˆ`ref` as a propï¼‰ï¼Œåœ¨å¾ˆå¤šåœºæ™¯ä¸‹å‡å°‘äº†å¯¹ `forwardRef` çš„éœ€è¦ã€‚
- `useFormStatus`ï¼ˆæ¥è‡ª `react-dom`ï¼‰ï¼šè¯»å–çˆ¶ `<form>` çš„çŠ¶æ€ï¼ˆpendingã€dataã€methodã€actionï¼‰ï¼Œæ–¹ä¾¿è®¾è®¡ç³»ç»Ÿå†…çš„ç»„ä»¶è¯»å– form çŠ¶æ€è€Œä¸ç”¨å±‚å±‚é€ä¼  propsã€‚

### 3.3. React DOM å®¢æˆ·ç«¯ï¼ˆè¡¨å•/èµ„æº/è„šæœ¬/æ ·å¼ç›¸å…³çš„æ”¹è¿›ï¼‰

- `<form action>` / `<input formAction>` / `<button formAction>`ï¼šç°åœ¨å¯ä»¥æŠŠå‡½æ•°ä¼ ç»™ `action` / `formAction`ï¼ŒReact ä¼šæŠŠå®ƒå½“ä½œ Action è‡ªåŠ¨æäº¤ã€ç®¡ç† pending çŠ¶æ€å¹¶åœ¨æˆåŠŸåè‡ªåŠ¨é‡ç½®éå—æ§è¡¨å•ï¼Œå¦æä¾› `requestFormReset` æ¥æ‰‹åŠ¨è§¦å‘é‡ç½®ã€‚éå¸¸è´´åˆ progressive enhancement + å…¨æ ˆ React çš„ä½¿ç”¨æ¨¡å¼ã€‚
- Document metadata åŸç”Ÿæ”¯æŒï¼šReact èƒ½åœ¨ç»„ä»¶æ ‘ä¸­æ¸²æŸ“ metadataï¼ˆå¤´éƒ¨æ ‡ç­¾ï¼‰ï¼Œå¹¶æŠŠå®ƒä»¬æå‡åˆ° `<head>`ã€‚
- æ ·å¼è¡¨ï¼ˆstylesheetsï¼‰æ”¯æŒï¼šå½“æŸä¸ª Suspense è¾¹ç•Œä¾èµ–äºæ ·å¼è¡¨æ—¶ï¼ŒReact ä¼šç¡®ä¿ç›¸å…³ stylesheet åœ¨ reveal ä¹‹å‰è¢«æ’å…¥åˆ° `<head>`ï¼Œå‡å°‘é—ªçƒ/æ ·å¼å¤±é…ã€‚
- æ”¯æŒ async scriptsã€ä»¥åŠèµ„æºé¢„åŠ è½½ APIï¼ˆ`preinit`, `preload`, `prefetchDNS`, `preconnect`ï¼‰ï¼Œç”¨äºä¼˜åŒ–é¦–å±åŠ è½½å’Œé¢„å–åœºæ™¯ã€‚

### 3.4. æœåŠ¡ç«¯æ¸²æŸ“ / Server Components / é™æ€ç”Ÿæˆ

- æ–°å¢ `prerender` ä¸ `prerenderToNodeStream`ï¼ˆé¢å‘é™æ€ç«™ç‚¹ç”Ÿæˆï¼Œç­‰å¾…æ•°æ®åŠ è½½å†ç”Ÿæˆ HTMLï¼Œé€‚é… Node Streams / Web Streamsï¼‰ã€‚
- React Server Componentsï¼ˆRSCï¼‰ç›¸å…³ç‰¹æ€§ï¼ˆdirectivesã€server componentsã€server functionsï¼‰è¿›å…¥ç¨³å®šï¼ˆstableï¼‰ï¼Œç¬¬ä¸‰æ–¹åº“å¯ä»¥å°† RSC ä½œä¸º peer dependency é¢å‘ React 19 å‘å¸ƒã€‚ä½†æ³¨æ„ï¼šå®ç° RSC çš„åº•å±‚å·¥å…·é“¾ API åœ¨ minor ç‰ˆæœ¬å†…å¯èƒ½ä¸å®Œå…¨éµå®ˆ semverï¼ˆæ‰“åŒ…/bundler ç›¸å…³çš„æ¥å£å¯èƒ½åœ¨å°ç‰ˆæœ¬é—´å˜åŒ–ï¼‰ã€‚

### 3.5. é‡è¦è¡Œä¸ºå˜åŒ– / Strict Mode & è¿è¡Œæ—¶æ³¨æ„äº‹é¡¹

- New JSX Transform ç°åœ¨æ˜¯å¿…é¡»çš„ï¼ˆReact 19 å¼•å…¥çš„è‹¥å¹²æ€§èƒ½ä¸è¯­æ³•æ”¹è¿›ä¾èµ–æ–°ç‰ˆçš„ JSX transformï¼‰ã€‚å¦‚æœä½ çš„æ„å»ºé“¾ä»åœ¨ç”¨æ—§ transformï¼Œéœ€è¦å…ˆå‡çº§å·¥å…·é“¾ã€‚
- ä¸¥æ ¼æ¨¡å¼ï¼ˆStrictModeï¼‰åœ¨å¼€å‘ç¯å¢ƒä¸‹ç»§ç»­åŠ å¼ºæ£€æŸ¥ï¼šæ¯”å¦‚ `useMemo` / `useCallback` åœ¨ç¬¬äºŒæ¬¡æ¸²æŸ“æ—¶ä¼šé‡ç”¨ç¬¬ä¸€ä¸ªæ¸²æŸ“çš„ memoized ç»“æœï¼›ref callback åœ¨åˆæ¬¡ mount æ—¶ä¼š double-invokeï¼ˆå¼€å‘ç¯å¢ƒç”¨äºå‘ç°å‰¯ä½œç”¨ï¼‰ã€‚
- é”™è¯¯å¤„ç†å˜æ›´ï¼šæ¸²æŸ“ä¸­çš„æœªè¢« Error Boundary æ•è·çš„é”™è¯¯ä¸å†è¢«é‡æ–°æŠ›å‡ºï¼Œè€Œæ˜¯é€šè¿‡ `window.reportError` æŠ¥å‘Šï¼›å¯¹å·²è¢« Error Boundary æ•è·çš„é”™è¯¯åˆ™ä¼šé€šè¿‡ `console.error`ã€‚`createRoot` / `hydrateRoot` æ–°å¢ `onUncaughtError` ä¸ `onCaughtError` é€‰é¡¹ä»¥è‡ªå®šä¹‰è¿™ç±»è¡Œä¸ºã€‚

### 3.6. è¢«ç§»é™¤ / å¼ƒç”¨ï¼ˆBreaking changes & Removals â€” è¦è®¤çœŸå¯¹å¾…ï¼‰

React 19 ç§»é™¤äº†è®¸å¤šé•¿æœŸå·²è¢«æ ‡è®°ä¸ºé—ç•™æˆ–å¼ƒç”¨çš„ APIï¼ˆè¯·åŠ¡å¿…åœ¨å‡çº§å‰å®¡æŸ¥å¹¶ codemodï¼‰ï¼š

- åˆ é™¤ / ç§»é™¤ï¼ˆé‡è¦ï¼‰ï¼š`ReactDOM.render`ã€`ReactDOM.hydrate`ï¼ˆæ”¹ç”¨ `createRoot` / `hydrateRoot`ï¼‰ï¼Œ`unmountComponentAtNode` â†’ `root.unmount()`ã€‚
- `propTypes`ï¼šä½¿ç”¨å°†è¢«å¿½ç•¥ï¼ˆå»ºè®®è¿ç§»åˆ° TypeScript æˆ–å…¶ä»–ç±»å‹æ£€æŸ¥æ–¹æ¡ˆï¼‰ã€‚
- `defaultProps`ï¼ˆå¯¹å‡½æ•°ç»„ä»¶ï¼‰è¢«ç§»é™¤ï¼ˆå‡½æ•°é»˜è®¤å‚æ•°å–ä»£ï¼‰ï¼›ç±»ç»„ä»¶ä»ç„¶æ”¯æŒ `defaultProps`ã€‚
- `contextTypes` / `getChildContext`ï¼ˆæ—§çš„ class ç»„ä»¶ Legacy Contextï¼‰è¢«ç§»é™¤ï¼›å­—ç¬¦ä¸² refs è¢«ç§»é™¤ï¼›`React.createFactory` è¢«ç§»é™¤ï¼›`react-dom/test-utils` å¤§éƒ¨åˆ†å·¥å…·å·²ç§»å‡ºï¼ˆ`act` å·²ç§»åŠ¨åˆ° `react`ï¼‰ã€‚
- UMD æ„å»ºè¢«ç§»é™¤ï¼šè¦é€šè¿‡ ESM CDNï¼ˆå¦‚ esm.shï¼‰æˆ– ESM åŒ…æ¥ä½¿ç”¨ Reactã€‚

> å°ç»“ï¼šå¦‚æœä½ çš„ä»£ç åº“é‡Œè¿˜å­˜åœ¨è€å¼çš„ string refsã€legacy contextã€æˆ–ä¾èµ– `propTypes` åšè¿è¡Œæ—¶é€»è¾‘ï¼Œå‡çº§å‰å¿…é¡»æ›¿æ¢æˆ–ç§»é™¤ï¼Œå¦åˆ™ä¼šè¢«æ— å£°å¿½ç•¥æˆ–äº§ç”Ÿé”™è¯¯ã€‚

### 3.7. TypeScript æ”¹åŠ¨ä¸ Codemodï¼ˆå®æ“å»ºè®®ï¼‰

- React 19 ç§»é™¤/è°ƒæ•´äº†ä¸€æ‰¹ TypeScript ç±»å‹ï¼ˆä¾‹å¦‚ `ReactChild`ã€`ReactFragment`ã€`ReactText` ç­‰ï¼‰ï¼Œå®˜æ–¹æä¾›äº† codemodï¼ˆ`npx types-react-codemod@latest preset-19 ./path-to-your-react-ts-files`ï¼‰æ¥å¸®åŠ©è‡ªåŠ¨åŒ–è¿ç§»ã€‚
- refs è¡Œä¸ºçš„ç±»å‹ä¸¥æ ¼åŒ–ï¼šä¸å…è®¸éšå¼è¿”å›éå‡½æ•°çš„å€¼ä½œä¸º ref cleanupï¼›è¦æ±‚ `useRef` ä¼ å…¥åˆå§‹å‚æ•°ç­‰ã€‚æ³¨æ„è¿™äº›æ”¹åŠ¨ä¼šå½±å“ä¸¥æ ¼ç±»å‹æ£€æŸ¥ã€‚

### 3.8. å‡çº§å»ºè®®ï¼ˆå®è·µæ­¥éª¤ï¼‰

å®˜æ–¹å»ºè®®çš„å‡çº§è·¯å¾„ï¼ˆæ‘˜è¦ï¼‰ï¼š

1. å…ˆå‡çº§åˆ° React 18.3.1ï¼ˆè¿™æ˜¯ä¸€ä¸ªä¸ 18.2 è¡Œä¸ºç›¸åŒä½†ä¼šå¯¹å°†è¢«ç§»é™¤çš„ API æ·»åŠ è­¦å‘Šçš„ç‰ˆæœ¬ï¼‰ï¼Œç”¨ä»¥æå‰æš´éœ²å…¼å®¹æ€§é—®é¢˜ã€‚
2. é˜…è¯»å¹¶æŒ‰ç…§ React 19 Upgrade Guide æ‰§è¡Œ codemodsï¼ˆTypeScript codemodã€å…¶ä»–è‡ªåŠ¨æ›¿æ¢è„šæœ¬ï¼‰å¹¶ä¿®å¤è­¦å‘Š/é”™è¯¯ã€‚([react.dev][3])
3. é‡ç‚¹æ‰«æå¹¶æ›¿æ¢ï¼š`propTypes` ä¾èµ–ã€string refsã€legacy contextã€`ReactDOM.render` çš„è°ƒç”¨ã€ä»»ä½•ä½¿ç”¨ `react-dom/test-utils` çš„æµ‹è¯•å·¥å…·ï¼ˆè¿ç§»åˆ° `react` çš„ `act` æˆ–ä½¿ç”¨ React Testing Libraryï¼‰ã€‚
4. åœ¨å¤§å‹åº”ç”¨ä¸­ï¼Œè€ƒè™‘åˆ†é˜¶æ®µå‡çº§å¹¶åœ¨ CI ä¸­å¼ºåˆ¶è¿è¡Œ codemod ä»¥é™ä½æ‰‹å·¥é”™è¯¯ã€‚

### 3.9. å¸¸è§è¿ç§»ç‰‡æ®µï¼ˆç¤ºä¾‹ï¼‰

æ›¿æ¢æ—§ `ReactDOM.render` â†’ æ–° root APIï¼ˆç¤ºä¾‹ï¼‰ï¼š

```js
// React 17 åŠæ›´æ—©ï¼ˆå·²ç§»é™¤äº v19ï¼‰
// ReactDOM.render(<App />, container)

// React 18+ æ¨èï¼ˆv19 è¦ä½¿ç”¨ createRoot/hydrateRootï¼‰
import { createRoot } from 'react-dom/client'

const root = createRoot(container, {
  onUncaughtError(error) {
    /* å¯é€‰ï¼šè‡ªå®šä¹‰æœªæ•è·é”™è¯¯å¤„ç† */
  },
})
root.render(<App />)
```

ï¼ˆæ³¨æ„ï¼šv19 å·²ç§»é™¤æ—§ APIï¼Œè¯·ç¡®ä¿ç§»é™¤æ‰€æœ‰å¯¹æ—§ API çš„ç›´æ¥è°ƒç”¨ã€‚ï¼‰

### 3.10. æ€»ç»“

- ä¸»è½´ï¼šæŠŠã€ŒActionï¼ˆå¼‚æ­¥ Transitionï¼‰+ è¡¨å•/æœåŠ¡å™¨é›†æˆã€ä½œä¸ºä¸€ç­‰å…¬æ°‘ï¼Œæå¤§ç®€åŒ–è¡¨å•æäº¤ã€ä¹è§‚æ›´æ–°ã€é”™è¯¯å¤„ç†ç­‰å¸¸è§æµç¨‹ã€‚
- å·¥å…·é“¾å½±å“ï¼šå¿…é¡»é‡‡çº³æ–°ç‰ˆ JSX transformã€å¤„ç†è‹¥å¹²ç§»é™¤é¡¹ï¼ˆpropTypesã€string refsã€æ—§ context ç­‰ï¼‰ã€å¹¶ä½¿ç”¨å®˜æ–¹ codemod è¿ç§» TypeScript ç±»å‹ã€‚
- å‡çº§å»ºè®®ï¼šå…ˆåˆ° `18.3.1` æ£€æŸ¥å¹¶ä¿®å¤è­¦å‘Šï¼Œå†æŒ‰ Upgrade Guide + codemod åˆ†é˜¶æ®µè¿ç§»ã€‚

## 4. ğŸ”— å¼•ç”¨ï¼ˆå®˜æ–¹åŸæ–‡ï¼‰

- [GitHub][1]
  - React å®˜æ–¹ Release Notesï¼ˆGitHub v19.0.0ï¼‰ã€‚
- [react.dev][2]
  - React å›¢é˜Ÿåšå®¢ï¼šReact v19ï¼ˆfeature è¯¦è§£ä¸ç¤ºä¾‹ï¼‰ã€‚
- [react.dev][3]
  - React v19 Upgrade Guideï¼ˆå« codemod / è¿ç§»æ­¥éª¤ï¼‰ã€‚

[1]: https://github.com/facebook/react/releases/tag/v19.0.0
[2]: https://react.dev/blog/2024/04/25/react-19
[3]: https://react.dev/blog/2024/04/25/react-19-upgrade-guide
